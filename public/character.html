<!DOCTYPE html>
<html lang="ko">

<head>
    <script src="/env.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <title>캐릭터 이름 | 크라마(crama)</title>
  <meta name="description" content="크라마(crama) 캐릭터와 실시간으로 대화하고 취향에 맞는 상황을 만들어 보세요.">
  <meta property="og:title" content="캐릭터 채팅 | 크라마(crama)">
  <meta property="og:description" content="선택한 캐릭터 프로필과 대화 히스토리를 한 화면에서 확인하고 이어가세요.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://crama.app/character">
  <meta property="og:site_name" content="크라마(crama)">
  <meta property="og:image" content="https://crama.app/assets/og-default.png">
  <meta property="og:locale" content="ko_KR">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="캐릭터 채팅 | 크라마(crama)">
  <meta name="twitter:description" content="선택한 캐릭터 프로필과 대화 히스토리를 한 화면에서 확인하고 이어가세요.">
  <meta name="twitter:image" content="https://crama.app/assets/og-default.png">
  <link rel="canonical" href="https://crama.app/character">
  <link rel="stylesheet" href="./css/common.css">
  <link rel="stylesheet" href="./css/index.css">
  <link rel="stylesheet" href="./css/character.css">
</head>

<body data-page="character" class="page page-character">
  <div class="app">
    <!-- 상단 헤더: menu.html 패턴 적용 -->
    <header class="top-bar">
      <div class="top-bar-left">
        <button class="back-btn" id="mobileNavBtn" aria-label="메뉴 열기">
          ☰
        </button>
        <span class="top-title">캐릭터 채팅</span>
      </div>
      <div class="top-bar-right">
        <a href="/create-character" class="top-add">+ 캐릭터 만들기</a>
      </div>
    </header>

    <div class="content">
      <!-- 사이드바 (공통) -->
      <div id="sidebar-container"></div>

      <!-- 전역 드로어 (공통) -->
      <div id="drawer-container"></div>

      <!-- 메인 -->
      <main class="main-area page-main">
        <div class="character-layout">
          <!-- 좌측: 채팅 영역 -->
          <section class="character-chat">
            <!-- 캐릭터 프로필 헤더 -->
            <div class="character-profile-header">
              <div class="character-profile-main">
                <div class="character-avatar-wrapper">
                  <img src="/assets/img/sample-character-01.png" alt="캐릭터" class="character-avatar" />
                  <span class="character-status-dot"></span>
                </div>
                <div class="character-info">
                  <div class="character-name-row">
                    <h1 class="character-name">서은빈</h1>
                    <span class="badge badge--share">수익 쉐어</span>
                  </div>
                  <!-- <p class="character-tagline">게임까지 이사한 이 셀카를 잘못 보낸 것 같다</p> -->

                </div>
                              <div class="character-actions">
                <button class="btn-icon btn-favorite" title="좋아요">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                  </svg>
                </button>
                <button class="btn-icon btn-info-toggle" id="sideToggleBtn" title="상세정보">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                  </svg>
                </button>
              </div>
              </div>

            </div>

            <div class="scene-mode-bar">
              <div class="scene-mode-copy">
                <div class="scene-mode-title-row">
                  <div class="scene-mode-title">SCENE 모드</div>
                  <div class="scene-mode-info-wrapper">
                    <button type="button" class="scene-mode-info-btn" id="sceneModeInfoBtn" aria-expanded="false" aria-controls="sceneModeInfo">i</button>
                    <div class="scene-mode-info hidden" id="sceneModeInfo">
                      상황 이미지를 자동으로 불러와 장면을 연출해요. 이미지가 사용되면 추가 scene이 차감됩니다.
                    </div>
                  </div>
                  <div class="scene-template-header">
                <button type="button" class="scene-template-toggle" id="sceneTemplateToggle" aria-expanded="false">
                  SCENE 미리보기
                </button>
              </div>
                </div>
              </div>
              <label class="scene-switch" aria-label="SCENE 모드 토글">
                <input type="checkbox" id="sceneModeToggle" />
                <span class="scene-switch__slider"></span>
              </label>
            </div>

            <div class="scene-template-panel">
              <div class="scene-template-strip scene-template-strip--collapsed" id="sceneTemplateStrip">
                <p class="scene-template-empty">등록된 상황 이미지가 없습니다.</p>
              </div>
            </div>

            <!-- 채팅 메시지 영역 -->
            <div class="chat-messages-container">
              <div class="character-intro-hero" id="characterIntroHero">
                <div class="intro-hero__image">
                  <img id="characterIntroHeroImage" src="/assets/sample-character-02.png" alt="인트로 이미지" />
                </div>
                <div class="intro-hero__text">
                  <div class="intro-hero__label">인트로 장면</div>
                  <p id="characterIntroHeroText">인트로 내용이 여기에 표시됩니다.</p>
                </div>
              </div>
              <button type="button" class="chat-load-more hidden" id="chatLoadMoreBtn">이전 대화 불러오기</button>
              <div class="chat-window" id="chatWindow">
                <!-- 채팅 메시지들이 여기에 동적으로 추가됩니다 -->
              </div>
            </div>

            <!-- 채팅 입력 영역 -->
            <form class="chat-input-wrapper" id="chatForm">
              <div class="chat-input-container">
                <button type="button" class="chat-input-icon chat-insert-scene" id="chatInsertSceneBtn" title="상황 묘사 삽입">
                  ✱
                </button>
                <textarea 
                  class="chat-input-field" 
                  placeholder="메시지를 입력하세요..."
                  rows="1"
                ></textarea>
                <button type="submit" class="chat-input-send">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                  </svg>
                </button>
              </div>
            </form>
          </section>

          <!-- 우측: 캐릭터 상세정보 패널 -->
          <aside class="character-side character-side--collapsed">
            <div class="character-side-content">
              <div class="character-side-header">
                <h2 class="character-side-title">캐릭터 정보</h2>
                                  <div class="character-stats">
                    <span class="stat-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                      </svg>
                      <span>1.6K</span>
                    </span>
                    <span class="stat-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                      </svg>
                      <span>100</span>
                    </span>
                    <span class="stat-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                      </svg>
                      <span>20.2K</span>
                    </span>
                  </div>
                
                <button class="btn-close-side" id="closeSideBtn">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>

              <div class="character-side-tabs">
                <button class="side-tab side-tab--active" data-panel="profilePanel">상세 정보</button>
                <button class="side-tab" data-panel="guidePanel">플레이 가이드</button>
                <button class="side-tab" data-panel="creatorPanel">크리에이터</button>
              </div>

              <!-- 상세 정보 패널 -->
              <div class="side-panel side-panel--active" id="profilePanel">
                <div class="panel-section">
                  <h3 class="panel-section-title">캐릭터 설명</h3>
                  
                  <p class="panel-section-text">
                    캐릭터의 성격이나 배경, 과거 사건 등 상세한 내용이 표시됩니다.
                  </p>
                </div>

                <div class="panel-section">
                  <div class="info-grid">
                    <div class="info-item">
                      <span class="info-label">장르</span>
                      <span class="info-value">일상, 로맨스</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">타겟</span>
                      <span class="info-value">연애/친구</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">해시태그</span>
                      <span class="info-value">#여사친 #공부 #대학</span>
                    </div>
                  </div>
                </div>

                <div class="panel-section">
                  <h3 class="panel-section-title">음성</h3>
                  <div class="voice-preview">
                    <button class="btn-voice-play">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                      </svg>
                      샘플 듣기
                    </button>
                    <span class="voice-label">방송 자료 기반 보이스</span>
                  </div>
                </div>
              </div>

              <!-- 플레이 가이드 패널 -->
              <div class="side-panel" id="guidePanel">
                <div class="panel-section">
                  <h3 class="panel-section-title">플레이 가이드</h3>
                  <p class="panel-section-text">
                    이 캐릭터는 일상 대화와 연애 상담에 최적화되어 있어요.
                    과한 폭력/수위 있는 요청에는 응답하지 않아요.
                  </p>
                </div>
              </div>

              <!-- 크리에이터 패널 -->
              <div class="side-panel" id="creatorPanel">
                <div class="panel-section">
                  <h3 class="panel-section-title">크리에이터 & 수익 쉐어</h3>
                  <div class="creator-info">
                    <div class="creator-item">
                      <span class="creator-label">캐릭터 제작자</span>
                      <span class="creator-value">@사용자닉네임</span>
                    </div>
                    <div class="creator-item">
                      <span class="creator-label">수익 쉐어</span>
                      <span class="creator-value">50% (플랫폼) / 50% (크리에이터)</span>
                    </div>
                  </div>
                </div>

                <div class="panel-section">
                  <button class="btn-panel-action">
                    이 캐릭터로 방송하기 가이드 보기
                  </button>
                  <button class="btn-panel-action">
                    내 방송 자료 업로드하고 말투 맞춤화
                  </button>
                </div>

                <!-- 내가 만든 캐릭터일 때만 노출 -->
                <div class="panel-section creator-owner-section" style="display: none;">
                  <a href="/create-character?id=123" class="btn-panel-primary">
                    캐릭터 설정 수정하기
                  </a>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </main>
    </div>
  </div>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- 전역 supabase 클라이언트 생성 -->
  <script src="js/common.js"></script>
  <script src="js/authWidget.js"></script>
  <script src="js/credits.js"></script>
  <script src="js/character.js"></script>
</body>

</html>
