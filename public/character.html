<!DOCTYPE html>
<html lang="ko">

<head>
    <script src="/env.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <title>캐릭터 이름 | 크라마(crama)</title>
  <meta name="description" content="크라마(crama) 캐릭터와 실시간으로 대화하고 취향에 맞는 상황을 만들어 보세요.">
  <meta property="og:title" content="캐릭터 채팅 | 크라마(crama)">
  <meta property="og:description" content="선택한 캐릭터 프로필과 대화 히스토리를 한 화면에서 확인하고 이어가세요.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://crama.app/character">
  <meta property="og:site_name" content="크라마(crama)">
  <meta property="og:image" content="https://crama.app/assets/og-default.png">
  <meta property="og:locale" content="ko_KR">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="캐릭터 채팅 | 크라마(crama)">
  <meta name="twitter:description" content="선택한 캐릭터 프로필과 대화 히스토리를 한 화면에서 확인하고 이어가세요.">
  <meta name="twitter:image" content="https://crama.app/assets/og-default.png">
  <link rel="canonical" href="https://crama.app/character">
  <link rel="stylesheet" href="./css/url-bar.css">
  <link rel="stylesheet" href="./css/common.css">
  <link rel="stylesheet" href="./css/index.css">
  <link rel="stylesheet" href="./css/character.css">
  <link rel="stylesheet" href="./css/character-detail-modal.css">
</head>

<body data-page="character" class="page page-character">
  <div class="app">
    <!-- 상단 헤더: menu.html 패턴 적용 -->
    <header class="top-bar">
      <div class="top-bar-left">
        <button class="back-btn" id="mobileNavBtn" aria-label="메뉴 열기">
          ☰
        </button>
        <span class="top-title">캐릭터 채팅</span>
      </div>
      <div class="top-bar-right">
        <a href="/create-character" class="top-add-btn" id="topCreateCharacterBtn">+ 캐릭터 만들기</a>
        <button type="button" class="top-login-btn" id="topLoginBtn">로그인</button>
      </div>
    </header>

    <div class="content">
      <!-- 사이드바 (공통) -->
      <div id="sidebar-container"></div>

      <!-- 전역 드로어 (공통) -->
      <div id="drawer-container"></div>

      <!-- 메인 -->
      <main class="main-area page-main">
        <div class="character-layout">
          <!-- 좌측: 채팅 영역 -->
          <section class="character-chat">
            <!-- 캐릭터 프로필 헤더 -->
            <div class="character-profile-header">
              <div class="character-headline">
                <button type="button" class="character-name-trigger" id="characterDetailTrigger" aria-label="캐릭터 상세 보기">
                  <h1 class="character-name">서은빈</h1>
                  <span class="character-name-arrow" aria-hidden="true">›</span>
                </button>
                <span class="badge badge--share">수익 쉐어</span>
              </div>
              <div class="character-toolbar">
                <button
                  type="button"
                  class="character-toolbar-icon"
                  id="chatModeSheetBtn"
                  aria-label="챗 모드 선택"
                  title="챗 모드 선택"
                >
                  <svg viewBox="0 0 24 24" focusable="false">
                    <path d="M4 4h16a2 2 0 0 1 2 2v8.5a2 2 0 0 1-2 2H9l-4.5 3.5a1 1 0 0 1-1.6-.8V6a2 2 0 0 1 2-2Z" />
                  </svg>
                </button>
                <button
                  type="button"
                  class="character-toolbar-icon"
                  id="sceneSkinSheetBtn"
                  aria-label="Scene 스킨 선택"
                  title="Scene 스킨 선택"
                >
                  <svg viewBox="0 0 24 24" focusable="false">
                    <path d="M12 3.5 3 9v6l9 5.5 9-5.5V9Z"></path>
                  </svg>
                </button>
                <button
                  type="button"
                  class="character-toolbar-icon"
                  id="sideToggleBtn"
                  aria-label="캐릭터 정보 패널"
                  title="캐릭터 정보 패널"
                >
                  <svg viewBox="0 0 24 24" focusable="false">
                    <circle cx="12" cy="12" r="2"></circle>
                    <circle cx="19" cy="12" r="2"></circle>
                    <circle cx="5" cy="12" r="2"></circle>
                  </svg>
                </button>
              </div>
            </div>


            <p class="scene-mode-note" id="sceneModeNote"></p>

            <div class="scene-template-panel">
              <div class="scene-template-strip scene-template-strip--collapsed" id="sceneTemplateStrip">
                <p class="scene-template-empty">등록된 상황 이미지가 없습니다.</p>
              </div>
            </div>

            <!-- 채팅 메시지 영역 -->
            <div class="chat-messages-container">
              <div class="character-intro-hero" id="characterIntroHero">
                <div class="intro-hero__image">
                  <img id="characterIntroHeroImage" src="/assets/sample-character-02.png" alt="인트로 이미지" />
                </div>
                <div class="intro-hero__text">
                  <div class="intro-hero__label">인트로 장면</div>
                  <p id="characterIntroHeroText">인트로 내용이 여기에 표시됩니다.</p>
                </div>
              </div>
              <button type="button" class="chat-load-more hidden" id="chatLoadMoreBtn">이전 대화 불러오기</button>
              <div class="chat-window" id="chatWindow">
                <!-- 채팅 메시지들이 여기에 동적으로 추가됩니다 -->
              </div>
            </div>

            <!-- 채팅 입력 영역 -->
            <form class="chat-input-wrapper" id="chatForm">
              <div class="chat-input-container">
                <button type="button" class="chat-input-icon chat-insert-scene" id="chatInsertSceneBtn" title="상황 묘사 삽입">
                  ✱
                </button>
                <textarea 
                  class="chat-input-field" 
                  placeholder="메시지를 입력하세요..."
                  rows="1"
                ></textarea>
                <button type="submit" class="chat-input-send">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                  </svg>
                </button>
              </div>
            </form>
          </section>

          <!-- 우측: 캐릭터 상세정보 패널 -->
          <aside class="character-side character-side--collapsed">
            <div class="character-side-content">
              <div class="character-side-header">
                <h2 class="character-side-title">캐릭터 정보</h2>
                                  <div class="character-stats">
                    <span class="stat-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                      </svg>
                      <span>1.6K</span>
                    </span>
                    <span class="stat-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                      </svg>
                      <span>100</span>
                    </span>
                    <span class="stat-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                      </svg>
                      <span>20.2K</span>
                    </span>
                  </div>
                
                <button class="btn-close-side" id="closeSideBtn">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>

              <div class="character-side-tabs">
                <button class="side-tab side-tab--active" data-panel="profilePanel">상세 정보</button>
                <button class="side-tab" data-panel="guidePanel">플레이 가이드</button>
                <button class="side-tab" data-panel="creatorPanel">크리에이터</button>
              </div>

              <!-- 상세 정보 패널 -->
              <div class="side-panel side-panel--active" id="profilePanel">
                <div class="panel-section">
                  <h3 class="panel-section-title">캐릭터 설명</h3>
                  
                  <p class="panel-section-text">
                    캐릭터의 성격이나 배경, 과거 사건 등 상세한 내용이 표시됩니다.
                  </p>
                </div>

                <div class="panel-section">
                  <div class="info-grid">
                    <div class="info-item">
                      <span class="info-label">장르</span>
                      <span class="info-value">일상, 로맨스</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">타겟</span>
                      <span class="info-value">연애/친구</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">해시태그</span>
                      <span class="info-value">#여사친 #공부 #대학</span>
                    </div>
                  </div>
                </div>

                <div class="panel-section">
                  <h3 class="panel-section-title">음성</h3>
                  <div class="voice-preview">
                    <button class="btn-voice-play">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                      </svg>
                      샘플 듣기
                    </button>
                    <span class="voice-label">방송 자료 기반 보이스</span>
                  </div>
                </div>
              </div>

              <!-- 플레이 가이드 패널 -->
              <div class="side-panel" id="guidePanel">
                <div class="panel-section">
                  <h3 class="panel-section-title">플레이 가이드</h3>
                  <p class="panel-section-text">
                    이 캐릭터는 일상 대화와 연애 상담에 최적화되어 있어요.
                    과한 폭력/수위 있는 요청에는 응답하지 않아요.
                  </p>
                </div>
              </div>

              <!-- 크리에이터 패널 -->
              <div class="side-panel" id="creatorPanel">
                <div class="panel-section">
                  <h3 class="panel-section-title">크리에이터 & 수익 쉐어</h3>
                  <div class="creator-info">
                    <div class="creator-item">
                      <span class="creator-label">캐릭터 제작자</span>
                      <span class="creator-value">@사용자닉네임</span>
                    </div>
                    <div class="creator-item">
                      <span class="creator-label">수익 쉐어</span>
                      <span class="creator-value">50% (플랫폼) / 50% (크리에이터)</span>
                    </div>
                  </div>
                </div>

                <div class="panel-section">
                  <button class="btn-panel-action">
                    이 캐릭터로 방송하기 가이드 보기
                  </button>
                  <button class="btn-panel-action">
                    내 방송 자료 업로드하고 말투 맞춤화
                  </button>
                </div>

                <!-- 내가 만든 캐릭터일 때만 노출 -->
                <div class="panel-section creator-owner-section" style="display: none;">
                  <a href="/create-character?id=123" class="btn-panel-primary">
                    캐릭터 설정 수정하기
                  </a>
                </div>
              </div>

            </div>
          </aside>
        </div>
      </main>
    </div>
  </div>

  <div class="character-sheet hidden" id="chatModeSheet" aria-hidden="true">
    <div class="character-sheet__backdrop" data-sheet-close="chatModeSheet"></div>
    <div class="character-sheet__panel" role="dialog" aria-modal="true" aria-labelledby="chatModeSheetTitle">
      <header class="character-sheet__header">
        <h3 id="chatModeSheetTitle">챗 모드 선택</h3>
        <button type="button" class="character-sheet__close" data-sheet-close="chatModeSheet" aria-label="닫기">×</button>
      </header>
      <div class="character-sheet__body">
        <section class="chat-mode-panel" id="chatModePanel">
          <div class="chat-mode-panel__header">
            <div class="chat-mode-panel__active">
              <p class="chat-mode-panel__label">현재 모드</p>
              <div class="chat-mode-panel__current">
                <span class="chat-mode-panel__name" id="chatModeActiveName">기본 모드</span>
                <span class="chat-mode-panel__meta" id="chatModeActiveMeta">토큰 정보 로딩 중</span>
              </div>
            </div>
            <div class="chat-mode-panel__actions">
              <button type="button" class="chat-mode-panel__adjust" id="chatModeAdjustBtn">
                최대 토큰 조절
              </button>
            </div>
          </div>
          <div class="chat-mode-list" id="chatModeList">
            <p class="chat-mode-panel__empty">모드 구성을 불러오는 중입니다.</p>
          </div>
          <p class="chat-mode-panel__tip" id="chatModeCreditTip">
            Scene 모드가 필요한 경우 ‘씬 브릿지 2.0’을 선택하세요.
          </p>
        </section>
      </div>
    </div>
  </div>

  <div class="character-sheet hidden" id="sceneSkinSheet" aria-hidden="true">
    <div class="character-sheet__backdrop" data-sheet-close="sceneSkinSheet"></div>
    <div class="character-sheet__panel" role="dialog" aria-modal="true" aria-labelledby="sceneSkinSheetTitle">
      <header class="character-sheet__header">
        <h3 id="sceneSkinSheetTitle">Scene 스킨 선택</h3>
        <button type="button" class="character-sheet__close" data-sheet-close="sceneSkinSheet" aria-label="닫기">×</button>
      </header>
      <div class="character-sheet__body">
        <div class="panel-section">
          <p class="panel-section-text">
            Scene 모드에서 획득한 이미지를 수집하면 채팅 배경으로 사용할 수 있어요.
          </p>
          <div class="background-collection" id="chatBackgroundCollection" data-empty="true">
            <p class="background-collection__empty">
              아직 수집된 Scene 이미지가 없습니다. Scene 모드를 활성화하고 장면 이미지를 받아보세요.
            </p>
          </div>
        </div>
        <div class="panel-section background-settings-actions">
          <button type="button" class="btn-panel-action" id="resetChatBackgroundBtn">
            기본 배경으로 되돌리기
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- 전역 supabase 클라이언트 생성 -->
  <script src="js/common.js"></script>
  <script src="js/authWidget.js"></script>
  <script src="js/credits.js"></script>
  <script src="js/characterDetailModal.js"></script>
  <script src="js/character.js"></script>

  <div class="chat-mode-modal" id="chatModeModal" aria-hidden="true">
    <div class="chat-mode-modal__backdrop" data-chat-mode-close></div>
    <div class="chat-mode-modal__panel" role="dialog" aria-modal="true" aria-labelledby="chatModeModalTitle">
      <header class="chat-mode-modal__header">
        <div>
          <p class="chat-mode-modal__eyebrow">출력량 & 크레딧</p>
          <h3 id="chatModeModalTitle">최대 토큰 상세 조정</h3>
        </div>
        <button type="button" class="chat-mode-modal__close" data-chat-mode-close aria-label="닫기">&times;</button>
      </header>
      <div class="chat-mode-modal__body" id="chatModeModalBody"></div>
      <footer class="chat-mode-modal__footer">
        <button type="button" class="chat-mode-modal__secondary" data-chat-mode-close>취소</button>
        <button type="button" class="chat-mode-modal__primary" id="chatModeModalSave">저장</button>
      </footer>
    </div>
  </div>
</body>

</html>
