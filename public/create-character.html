<!DOCTYPE html>
<html lang="ko">
  <head>
    <script src="/env.js"></script>
    <meta charset="UTF-8" />
    <title>캐릭터 만들기 | 크라마(crama)</title>
    <meta
      name="description"
      content="크라마(crama) 스튜디오에서 설정과 이미지를 입력해 나만의 캐릭터를 직접 만들어 보세요."
    />
    <meta property="og:title" content="캐릭터 만들기 | 크라마(crama)" />
    <meta
      property="og:description"
      content="성격, 배경, 이미지 레퍼런스를 조합해 새로운 캐릭터를 생성하고 공유하세요."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://crama.app/create-character" />
    <meta property="og:site_name" content="크라마(crama)" />
    <meta
      property="og:image"
      content="https://crama.app/assets/og-default.png"
    />
    <meta property="og:locale" content="ko_KR" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="캐릭터 만들기 | 크라마(crama)" />
    <meta
      name="twitter:description"
      content="성격, 배경, 이미지 레퍼런스를 조합해 새로운 캐릭터를 생성하고 공유하세요."
    />
    <meta
      name="twitter:image"
      content="https://crama.app/assets/og-default.png"
    />
    <link rel="canonical" href="https://crama.app/create-character" />
    <link rel="stylesheet" href="./css/common.css" />
    <link rel="stylesheet" href="./css/index.css" />
    <link rel="stylesheet" href="./css/create-character.css" />
  </head>

  <body data-page="create-character" class="page page-create-character">
    <div class="app">
      <!-- 상단 헤더: menu.html 패턴 -->
      <header class="top-bar">
        <div class="top-bar-left">
          <button class="back-btn" id="mobileNavBtn" aria-label="메뉴 열기">
            ☰
          </button>
          <span class="top-title">캐릭터 만들기</span>
        </div>
        <div class="top-bar-right">
          <button
            class="top-add-btn btn btn--ghost"
            type="button"
            data-save-draft
          >
            임시 저장
          </button>
          <button class="top-add-btn btn btn--primary" id="submitCharacter">
            등록하기
          </button>
        </div>
      </header>

      <div class="content">
        <!-- 사이드바 (공통) -->
        <div id="sidebar-container"></div>

        <!-- 전역 드로어 (공통) -->
        <div id="drawer-container"></div>

        <!-- 메인 -->

        <main class="main-area page-main" style="align-items: flex-start">
          <div class="create-layout">
            <!-- 좌측: 폼 -->
            <section class="create-layout__main card">
              <!-- 상단 탭 (스텝) -->
              <nav class="steps-nav">
                <button
                  class="steps-nav__item steps-nav__item--active"
                  data-step="step-basic"
                >
                  캐릭터 설정
                </button>
                <button class="steps-nav__item" data-step="step-intro">
                  인트로 & 예시
                </button>
                <button class="steps-nav__item" data-step="step-scenes">
                  상황 이미지
                </button>
                <button class="steps-nav__item" data-step="step-detail">
                  캐릭터 상세
                </button>
              </nav>
              <div class="steps-container">
                <!-- STEP 1: 캐릭터 설정 -->
                <div class="step step--active" id="step-basic">
                  <div class="step__header">
                    <h2 class="step__title">캐릭터 설정</h2>
                    <button
                      type="button"
                      class="btn btn--ghost btn--small step-preview-toggle"
                      data-preview-toggle
                    >
                      미리보기
                    </button>
                  </div>
                  <div class="step__scroll">
                    <!-- 이미지 -->
                    <div class="field-group">
                      <label class="field__label">캐릭터 이미지 *</label>
                      <p class="field__hint">
                        최대 5장까지 업로드할 수 있어요. 한 번에 여러 장을
                        선택하거나, 필요한만큼 추가로 등록해도 됩니다.
                      </p>
                      <div
                        class="image-upload-grid"
                        id="characterImageGrid"
                      ></div>
                      <div class="image-grid-actions">
                        <input
                          type="file"
                          id="characterImageInput"
                          class="sr-only"
                          accept="image/*"
                          multiple
                        />
                        <button
                          class="btn btn--secondary"
                          type="button"
                          id="imageUploadTrigger"
                        >
                          이미지 업로드
                        </button>
                        <button
                          class="btn btn--ghost btn--small"
                          type="button"
                          id="imageGenerateBtn"
                        >
                          이미지 생성
                        </button>
                        <span class="field__hint"
                          >썸네일 선택 시 목록/카드에 사용되고, 인트로 이미지는
                          소개 영역에 표시됩니다.</span
                        >
                      </div>
                    </div>

                    <div class="field-group">
                      <label class="field__label">캐릭터 이름 *</label>
                      <input
                        type="text"
                        class="field__control"
                        maxlength="12"
                        placeholder="2~12자"
                      />
                    </div>

                    <div class="field-group">
                      <label class="field__label">한 줄 소개 *</label>
                      <input
                        type="text"
                        class="field__control"
                        maxlength="30"
                        placeholder="30자 이내로 입력해 주세요"
                      />
                    </div>
                  </div>

                  <div class="step__footer">
                    <button
                      class="btn btn--primary step-next"
                      data-next="step-intro"
                    >
                      다음
                    </button>
                  </div>
                </div>

                <!-- STEP 2: 인트로 -->
                <div class="step" id="step-intro">
                  <div class="step__header">
                    <h2 class="step__title">인트로 및 예시 대화</h2>
                    <button
                      type="button"
                      class="btn btn--ghost btn--small step-preview-toggle"
                      data-preview-toggle
                    >
                      미리보기
                    </button>
                  </div>
                  <div class="step__scroll">
                    <div class="field-group">
                      <label class="field__label">인트로 *</label>
                      <textarea
                        id="introTextarea"
                        class="field__control field__control--textarea"
                        maxlength="1500"
                        placeholder="사용자에게는 보이지 않지만 캐릭터는 알고 있어야 하는 상황·배경 등을 작성해 주세요."
                      ></textarea>
                      <button class="btn btn--ghost btn--small">
                        예시 대화로부터 인트로 자동 생성
                      </button>
                    </div>

                    <div class="field-group">
                      <label class="field__label">예시 대화 (선택)</label>
                      <p class="field__hint">
                        캐릭터의 말투와 성격을 드러낼 수 있는 예시를 추가해
                        주세요.
                      </p>
                      <div class="example-dialog" id="exampleDialog">
                        <div
                          class="example-dialog__list"
                          id="exampleDialogList"
                        ></div>
                        <button
                          type="button"
                          class="btn btn--ghost btn--small"
                          id="addExamplePairBtn"
                        >
                          + 예시 대화 추가
                        </button>
                      </div>
                      <p class="field__hint">
                        + 버튼을 눌러 사용자와 캐릭터의 말풍선을 한 쌍씩
                        등록하고, 필요하면 삭제/편집할 수 있어요.
                      </p>
                    </div>

                    <div class="field-group">
                      <label class="field__label">플레이 가이드 (선택)</label>
                      <textarea
                        id="playGuideTextarea"
                        class="field__control field__control--textarea"
                        maxlength="500"
                        placeholder="사용자를 위한 가이드를 작성해 주세요."
                      ></textarea>
                    </div>
                  </div>

                  <div class="step__footer">
                    <button class="btn step-prev" data-prev="step-basic">
                      이전
                    </button>
                    <button
                      class="btn btn--primary step-next"
                      data-next="step-scenes"
                    >
                      다음
                    </button>
                  </div>
                </div>

                <!-- STEP 3: 상황 이미지 -->
                <div class="step" id="step-scenes">
                  <div class="step__header">
                    <h2 class="step__title">상황 이미지</h2>
                    <button
                      type="button"
                      class="btn btn--ghost btn--small step-preview-toggle"
                      data-preview-toggle
                    >
                      미리보기
                    </button>
                  </div>
                  <div class="step__scroll">
                    <p class="field__hint">
                      감정이나 상황에 맞는 이미지를 등록하면 SCENE 모드에서
                      캐릭터가 자동으로 불러올 수 있어요. (예: 부끄러울 때, 슬플
                      때, 적과 맞서 싸울 때)
                    </p>

                    <div class="scene-preset-list">
                      <span class="scene-preset-label">추천 키워드:</span>
                      <div class="scene-preset-chips">
                        <span class="chip">부끄러움</span>
                        <span class="chip">슬픔</span>
                        <span class="chip">기쁨</span>
                        <span class="chip">적과 맞서 싸울 때</span>
                        <span class="chip">분노</span>
                        <span class="chip">설렘</span>
                        <span class="chip">당황</span>
                      </div>
                    </div>

                    <div class="field-group">
                      <label class="field__label">상황 이미지 업로드</label>
                      <p class="field__hint">
                        최대 10장, PNG/JPG/WebP, 5MB 이하. 각 이미지마다
                        감정/상황 키워드를 지정해 주세요.
                      </p>
                      <div class="scene-upload-grid" id="sceneImageGrid"></div>
                      <div class="scene-grid-actions">
                        <input
                          type="file"
                          id="sceneImageInput"
                          class="sr-only"
                          accept="image/*"
                          multiple
                        />
                        <button
                          class="btn btn--secondary"
                          type="button"
                          id="sceneImageUploadTrigger"
                        >
                          상황 이미지 업로드
                        </button>
                        <span class="field__hint"
                          >등록한 이미지는 캐릭터 대화 중 자동으로 사용될 수
                          있어요.</span
                        >
                      </div>
                    </div>
                  </div>

                  <div class="step__footer">
                    <button class="btn step-prev" data-prev="step-intro">
                      이전
                    </button>
                    <button
                      class="btn btn--primary step-next"
                      data-next="step-detail"
                    >
                      다음
                    </button>
                  </div>
                </div>

                <!-- STEP 4: 고급 기능 (추후 활성화)
            <div class="step" id="step-advanced">
              <h2 class="step__title">고급 기능</h2>

              <div class="field-group">
                <label class="field__label">상황 이미지</label>
                <p class="field__hint">
                  상황에 어울리는 인물, 배경 등의 이미지를 등록해 보세요. (최대 50개)
                </p>
                <div class="field-inline">
                  <button class="btn btn--secondary">이미지 생성</button>
                  <input type="file" class="field__control" multiple />
                </div>
              </div>

              <div class="field-group">
                <label class="field__label">보이스 프리셋</label>
                <select class="field__control">
                  <option>업로드한 음성 그대로</option>
                  <option>더 밝게</option>
                  <option>더 차분하게</option>
                  <option>방송용 하이텐션</option>
                </select>
              </div>

              <div class="step__footer">
                <button class="btn step-prev" data-prev="step-prompt">이전</button>
                <button class="btn btn--primary step-next" data-next="step-detail">다음</button>
              </div>
            </div>
            -->

                <!-- STEP 5: 캐릭터 상세 -->
                <div class="step" id="step-detail">
                  <div class="step__header">
                    <h2 class="step__title">캐릭터 상세</h2>
                    <button
                      type="button"
                      class="btn btn--ghost btn--small step-preview-toggle"
                      data-preview-toggle
                    >
                      미리보기
                    </button>
                  </div>
                  <div class="step__scroll">
                    <div class="field-group">
                      <label class="field__label">캐릭터 설명 *</label>
                      <textarea
                        id="descriptionTextarea"
                        class="field__control field__control--textarea"
                        maxlength="1000"
                        placeholder="캐릭터의 성격이나 사사, 과거 사건 등 상세한 내용을 작성해 주세요."
                      ></textarea>
                    </div>

                    <div class="field-group">
                      <label class="field__label">캐릭터 프롬프트 *</label>
                      <textarea
                        id="promptTextarea"
                        class="field__control field__control--textarea"
                        maxlength="2000"
                        placeholder="캐릭터의 성격, 말투, 외모 등 대화에 반영되어야 하는 지시 사항을 작성해 주세요."
                      ></textarea>
                      <div class="field-inline field-inline--right">
                        <button
                          class="btn btn--ghost btn--small"
                          type="button"
                          id="promptAutoBtn"
                        >
                          인트로/예시 기반 자동 완성 (준비 중)
                        </button>
                      </div>
                    </div>

                    <div class="field-group">
                      <label class="field__label">장르 *</label>
                      <p class="field__hint">
                        캐릭터에 맞는 장르를 선택해 주세요.
                      </p>
                      <select class="field__control" id="genreSelect" required>
                        <option value="">장르를 선택해 주세요</option>
                        <option value="로맨스">로맨스</option>
                        <option value="로판">로판</option>
                        <option value="SF/판타지">SF/판타지</option>
                        <option value="일상/현대">일상/현대</option>
                        <option value="무협">무협</option>
                        <option value="시대">시대</option>
                        <option value="BL">BL</option>
                        <option value="GL">GL</option>
                        <option value="2차 창작">2차 창작</option>
                        <option value="유틸리티">유틸리티</option>
                        <option value="기타">기타</option>
                      </select>
                    </div>

                    <div class="field-group">
                      <label class="field__label">타깃 *</label>
                      <p class="field__hint">
                        캐릭터의 주 이용층을 선택해 주세요. 선택에 따라 추천
                        경험이 달라져요.
                      </p>
                      <select class="field__control" id="targetSelect" required>
                        <option value="">타깃을 선택해 주세요</option>
                        <option value="남성향">남성향</option>
                        <option value="여성향">여성향</option>
                        <option value="전체">전체</option>
                      </select>
                    </div>

                    <div class="field-group">
                      <label class="field__label">해시태그</label>
                      <p class="field__hint">
                        단어 입력 후 엔터를 눌러 등록하세요. (최대 10개)
                      </p>
                      <div class="tag-input" id="tagInput">
                        <div class="tag-input__chips" id="tagChipList">
                          <input
                            type="text"
                            id="tagInputField"
                            class="tag-input__field"
                            placeholder="#태그 입력 후 Enter"
                            maxlength="20"
                          />
                        </div>
                      </div>
                    </div>

                    <div class="field-group">
                      <label class="field__label">공개 여부 *</label>
                      <div class="radio-group">
                        <label class="radio">
                          <input
                            type="radio"
                            name="visibility"
                            value="public"
                            checked
                          />
                          <span
                            >공개 – 누구나 이 캐릭터와 대화할 수 있어요</span
                          >
                        </label>
                        <label class="radio">
                          <input
                            type="radio"
                            name="visibility"
                            value="private"
                          />
                          <span
                            >비공개 – 나만 이 캐릭터와 대화할 수 있어요</span
                          >
                        </label>
                        <label class="radio">
                          <input type="radio" name="visibility" value="link" />
                          <span
                            >링크 공개 – 링크를 가진 사람만 이 캐릭터와 대화할
                            수 있어요</span
                          >
                        </label>
                      </div>
                    </div>

                    <div class="field-group">
                      <label class="field__label">수익 쉐어 설정</label>
                      <label class="toggle">
                        <input type="checkbox" id="monetizedToggle" />
                        <span class="toggle__label"
                          >이 캐릭터를 수익 쉐어 캐릭터로 설정</span
                        >
                      </label>
                      <p class="field__hint">
                        캐릭터가 플랫폼 내에서 사용될 때 발생하는 수익을
                        크리에이터와 나눕니다.
                      </p>
                    </div>

                    <div class="field-group">
                      <label class="field__label">댓글 기능</label>
                      <label class="toggle">
                        <input type="checkbox" id="commentToggle" checked />
                        <span class="toggle__label">댓글 허용</span>
                      </label>
                    </div>
                  </div>

                  <div class="step__footer">
                    <button class="btn step-prev" data-prev="step-scenes">
                      이전
                    </button>
                    <button
                      class="btn btn--ghost"
                      type="button"
                      data-save-draft
                    >
                      임시 저장
                    </button>
                    <button class="btn btn--primary">등록</button>
                  </div>
                </div>
              </div>
            </section>

            <!-- 우측: 미리보기 -->
            <div class="create-layout__preview-mount" id="previewPanelMount">
              <aside class="create-layout__preview card" id="previewPanel">
                <header class="preview-header">
                  <h2 class="preview-header__title">미리보기</h2>
                </header>

                <div class="preview-card preview-card--list">
                  <div class="character-card card character-card--preview">
                    <div class="character-card__thumb">
                      <img
                        src="/assets/sample-character-01.png"
                        alt="캐릭터 썸네일"
                        id="previewImage"
                      />
                      <div
                        class="character-card__badge character-card__badge--share"
                        id="previewShareBadge"
                        style="display: none"
                      >
                        공유 가능
                      </div>
                    </div>
                    <div class="character-card__body">
                      <div class="character-card__title-row">
                        <h2 class="character-card__name" id="previewName">
                          캐릭터 이름
                        </h2>
                      </div>
                      <p class="character-card__summary" id="previewOneLine">
                        한 줄 소개가 여기에 표시됩니다.
                      </p>
                      <div class="character-card__meta">
                        <span class="meta-item">좋아요 0</span>
                        <span class="meta-item">채팅 0</span>
                        <span class="meta-item">조회수 0</span>
                      </div>
                      <div class="character-card__creator">
                        <div class="creator-avatar" id="previewCreatorAvatar">
                          CR
                        </div>
                        <div class="creator-info">
                          <div class="creator-name" id="previewCreatorName">
                            크리에이터
                          </div>
                          <div class="creator-handle" id="previewCreatorHandle">
                            @creator
                          </div>
                        </div>
                      </div>
                      <div class="character-card__tags" id="previewTags">
                        <span class="tag">#태그</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="preview-intro-block">
                  <div
                    class="character-intro-hero character-intro-hero--preview"
                    id="previewIntroHero"
                  >
                    <div
                      class="intro-hero__image"
                      id="previewIntroImageWrapper"
                    >
                      <img
                        id="previewIntroImage"
                        src="/assets/sample-character-02.png"
                        alt="인트로 미리보기"
                      />
                    </div>
                    <div class="intro-hero__text">
                      <div class="intro-hero__label">인트로 장면</div>
                      <p id="previewIntro">
                        인트로 입력 시 첫 대화에 사용됩니다.
                      </p>
                    </div>
                  </div>
                </div>
              </aside>
            </div>
          </div>
        </main>
      </div>
    </div>

    <div class="preview-modal" id="previewModal" aria-hidden="true">
      <div class="preview-modal__backdrop" data-preview-close></div>
      <div class="preview-modal__dialog" role="dialog" aria-modal="true">
        <button
          class="preview-modal__close"
          type="button"
          aria-label="미리보기 닫기"
          data-preview-close
        >
          ×
        </button>
        <div class="preview-modal__content" id="previewModalContent"></div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/common.js"></script>
    <script src="js/authWidget.js"></script>
    <script src="js/create-character.js"></script>
  </body>
</html>
