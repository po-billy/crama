<!DOCTYPE html>
<html lang="ko">
<head>
  <script src="/env.js"></script>
  <meta charset="UTF-8" />
  <title>로그인 | 크라마(crama)</title>
  <meta name="description" content="크라마(crama) 계정으로 로그인하고 크레딧, 캐릭터, 스튜디오 작업을 동기화하세요.">
  <meta property="og:title" content="크라마(crama) 로그인">
  <meta property="og:description" content="AI 챗과 스튜디오 기능을 이용하려면 구글 계정으로 빠르게 로그인하세요.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://crama.app/login">
  <meta property="og:site_name" content="크라마(crama)">
  <meta property="og:image" content="https://crama.app/assets/og-default.png">
  <meta property="og:locale" content="ko_KR">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="크라마(crama) 로그인">
  <meta name="twitter:description" content="AI 챗과 스튜디오 기능을 이용하려면 구글 계정으로 빠르게 로그인하세요.">
  <meta name="twitter:image" content="https://crama.app/assets/og-default.png">
  <link rel="canonical" href="https://crama.app/login">
  <link rel="stylesheet" href="./css/url-bar.css">
  <link rel="stylesheet" href="./css/common.css">
  <link rel="stylesheet" href="./css/login-modal.css">
  <style>
    body.login-forward {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #161628, #0b0c16 60%);
      color: rgba(255,255,255,0.8);
      font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
    }
    .login-forward__message {
      text-align: center;
      line-height: 1.6;
      max-width: 360px;
    }
  </style>
</head>
<body class="login-forward" data-page="login">
  <div class="login-forward__message">
    로그인 창을 여는 중입니다.<br>잠시만 기다려 주세요.
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/common.js"></script>
  <script src="js/authWidget.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const params = new URLSearchParams(window.location.search);
      const redirect = params.get('redirect') || window.location.origin;

      if (window.sb?.auth) {
        try {
          await window.sb.auth.getSession();
        } catch (err) {
          console.warn('login page session check failed', err);
        }
      }

      if (window.requireLogin) {
        const alreadyLoggedIn = await window.requireLogin({
          redirect,
          fromStandalone: true
        });
        if (alreadyLoggedIn) {
          window.location.assign(redirect);
        }
        return;
      }

      if (window.openLoginModal) {
        await window.openLoginModal({ redirect, fromStandalone: true });
        return;
      }

      // fallback: no modal helpers available
      window.location.href = '/';
    });
  </script>
</body>
</html>
